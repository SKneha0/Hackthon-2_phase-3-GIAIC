# Data Model: Backend Todo Application API

**Date**: 2026-02-06
**Feature**: 1-backend-fastapi-todo
**Status**: Complete

## Overview
This document defines the data structures and relationships for the backend todo application API, focusing on the database schema and entity definitions that align with the functional requirements.

## Entity Definitions

### Task Entity
**Description**: Represents a user's todo item that can be created, viewed, updated, and deleted.

**Attributes**:
- **id**: Integer (Primary Key, Auto-increment)
  - Unique identifier for each task
  - Auto-generated by the database
  - Required for all operations

- **title**: String (Required, Max length: 255)
  - The main text content of the task
  - Must be provided when creating a task
  - Used for display and identification

- **description**: String (Optional, Max length: 1000)
  - Additional details about the task
  - Can be empty or null
  - Provides context beyond the title

- **completed**: Boolean (Default: False)
  - Indicates whether the task has been completed
  - Used for filtering and status tracking
  - Can be toggled by the user

- **user_id**: Integer (Foreign Key to users table)
  - Links the task to the user who owns it
  - Critical for enforcing user isolation
  - Required for all database operations

- **created_at**: DateTime (Auto-generated)
  - Timestamp when the task was created
  - Automatically set on record creation
  - Used for sorting and audit purposes

- **updated_at**: DateTime (Auto-generated and Updated)
  - Timestamp when the task was last modified
  - Automatically updated on any record change
  - Used for tracking changes and audit purposes

**Relationships**:
- Belongs to a single User (via user_id foreign key)
- Each user can have multiple Tasks

**Validation Rules**:
- title must be provided and not empty
- user_id must correspond to an existing user
- completed must be a boolean value
- user cannot access tasks belonging to other users

### User Entity (Referenced)
**Description**: Represents an authenticated user in the system, managed by Better Auth.

**Attributes**:
- **id**: Integer (Primary Key)
  - Unique identifier for each user
  - Referenced by user_id in Task entity
  - Provided by Better Auth system

**Relationships**:
- Has many Tasks (one-to-many with Task.user_id)

**Note**: This entity is primarily managed by Better Auth. The backend will reference user IDs from JWT tokens.

## State Transitions

### Task Lifecycle
1. **Creation**: User creates a new task → Task.status = pending (completed = false)
2. **Update**: User modifies task properties → updated_at timestamp updated
3. **Completion**: User marks task as complete → completed = true
4. **Reopening**: User reopens completed task → completed = false
5. **Deletion**: User deletes task → Record removed from database

### Access Control States
1. **Authenticated**: User has valid JWT → Can access their own tasks
2. **Unauthorized**: Invalid/missing JWT → Access denied
3. **Forbidden**: Attempting to access other user's task → Access denied

## Database Schema

### Tasks Table
```sql
CREATE TABLE tasks (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    completed BOOLEAN DEFAULT FALSE,
    user_id INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_user_id (user_id),
    INDEX idx_completed (completed)
);
```

### Indexes
- **idx_user_id**: Optimizes queries filtering by user
- **idx_completed**: Optimizes queries filtering by completion status

## API Data Transfer Objects

### TaskCreate Schema
- **title**: String (Required) - Title of the new task
- **description**: String (Optional) - Description of the new task
- **completed**: Boolean (Optional, Default: False) - Initial completion status

### TaskUpdate Schema
- **title**: String (Optional) - New title (if changing)
- **description**: String (Optional) - New description (if changing)
- **completed**: Boolean (Optional) - New completion status

### TaskResponse Schema
- **id**: Integer - Task identifier
- **title**: String - Task title
- **description**: String - Task description
- **completed**: Boolean - Completion status
- **user_id**: Integer - Owner identifier
- **created_at**: DateTime - Creation timestamp
- **updated_at**: DateTime - Last update timestamp

### TaskListQuery Schema
- **status**: String Enum ["all", "pending", "completed"] (Default: "all") - Filter by completion status
- **sort**: String Enum ["created", "title"] (Default: "created") - Sort order